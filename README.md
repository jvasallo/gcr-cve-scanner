Google Container Registry - CVE Scanner
=======================================

As we all rushed to solve the Log4J crisis of 2021, many of us rushed to patch the knowns vulnerabilites, but what about those unknowns? You know those containers running in your Kubernetes environment that we rarely deploy (or in some cases forget they are there)?

GCP wrote an article using it's GCR's vulnerability scanner to look for CVEs.
https://cloud.google.com/blog/products/identity-security/recommendations-for-apache-log4j2-vulnerability

Their recommendation after the scan was: "once results are returned, you can search for the text CVE-2021-44228 using grep, a text editor, or your own script." This is fine for one scan, but if you want to scan 100s of containers this could be tedious.

Note: This can get expensive, as of this commit it is $0.26 cents per scan; reports are stored for 48 hours and subsequent scans are included. One can argue cost is not a factor when it comes to security!

Goal
====

Provide a quick way (not perfect way) to scan a GKE cluster using GCR for CVEs using GCR Container Analysis.

Requirements
============

- gcloud installed
- A GKE Cluster and configuration to connect to it (kubectl commands)
- GCR Repository for container images
- A list of CVEs you want to scan for

How To Run
==========

1. Update `ORG_GCR_PROJECT.txt` with your GCP GCR Project. This is used to scan containers that belong to your organization. 
2. Update the `CVEList.txt` with relevant CVEs you want to monitor. There are some default CVEs around log4j in there by default.
3. Ensure to switch kubectl context to the cluster you wish to pull images from.
4. Run: `bash scan_containers.sh`
5. Depending on how many containers found, it might take a while to scan the cluster. Once the scan is completed, a CSV will be generated `vulnreport.csv`.